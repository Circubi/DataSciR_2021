---
title: "twitter_text_processing"
output: html_document
---
```{r packages, message = FALSE}
library(rvest)
library(stringr)
library(rlist)
library(tidyverse)
library(jsonlite)
library(tokenizers)
library(dplyr)
library(tidytext)
library(syuzhet)
library(sentimentr)
```

```{r load_data}
mainDir <- "./data/" 
tweets <- list.load(file = paste(mainDir, "/tweets/tweets_list.RData",sep=""))
```

```{r transform_text}
# transform twitter text emojis to unicode
tweets_text <- tweets %>%
  map_dfr(~ bind_rows(.x)) %>%
  select(text, Player, DateTime, GameId, public_metrics) %>%
  mutate(retweet_count = tweets_text$public_metrics$retweet_count) %>%
  mutate(reply_count = tweets_text$public_metrics$reply_count) %>%
  mutate(like_count = tweets_text$public_metrics$like_count) %>%
  mutate(quote_count = tweets_text$public_metrics$quote_count) %>%
  select(text, Player, DateTime, GameId, retweet_count, reply_count, like_count, quote_count)

tweets_text <- map(tweets_text$text, format_) %>%
  list.rbind() %>%
  as.data.frame() %>%
  set_names("text_") %>%
  cbind(tweets_text)

format_ <- function(text){
    text <- text %>%
      str_replace_all("\\"," \\")
  return(text)
} 
```

```{r emoji_sentiment}
# get the emoji unicode and sentiment score
# http://kt.ijs.si/data/Emoji_sentiment_ranking/index.html
content <- read_html("http://kt.ijs.si/data/Emoji_sentiment_ranking/index.html")

table <- content %>%
  html_table() 

emoji_sentiment_score <- table[[1]] %>%
  select(Char, `Sentiment score[-1...+1]`) 

# get the emotions for emojis in unicode
#emoji_emotion <- fromJSON(paste(mainDir,"emoji_5sentiment_dictionary.json",sep ="")) %>%
#  bind_rows(.id = "id") %>%
#  mutate(id = iconv(id, "UTF-8", "ascii", "Unicode"))

# final emoji sentiment lexicon
emoji <- emoji_sentiment_score %>%
  full_join(emoji_emotion, by = c("Char" = "id"))
```

```{r sentiment}
emoji_dict <- emoji_sentiment_score[1:2] %>%
  rename(word = Char, value = `Sentiment score[-1...+1]`)
emoji_dict


a <- tweets_text$text %>%
  get_sentiment(method = "custom", lexicon = emoji_dict) 

tweets_text$text %>%
    get_sentences() %>%
    get_sentiment(method="syuzhet")
  
sentiments

fun_a <- function(text){
  sentiments <- text %>%
    get_sentences() %>%
    get_sentiment(method="syuzhet")
}
tweets_text$text %>%
  replace_emoticon() 
```

